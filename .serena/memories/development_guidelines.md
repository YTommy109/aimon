# AI-MAN プロジェクト開発ガイドライン

## 開発環境セットアップ

### 前提条件
- Python 3.12+
- uv（パッケージ管理）
- just（タスクランナー）
- direnv（環境変数管理）

### 初期セットアップ
1. **環境変数設定**
   ```bash
   cp .envrc.template .envrc
   # .envrc を編集して GEMINI_API_KEY を設定
   direnv allow
   ```

2. **依存関係インストール**
   ```bash
   uv sync --extra dev
   ```

## 開発ワークフロー

### 1. 機能開発
- 新機能は適切なレイヤーに配置
- テスト駆動開発（TDD）を推奨
- 型注釈を必ず付ける

### 2. テスト戦略
- **ユニットテスト**: 各レイヤーのロジック
- **インテグレーションテスト**: レイヤー間の連携
- **E2Eテスト**: ユーザー操作の流れ

### 3. コードレビュー
- 静的解析エラーの確認
- テストカバレッジの確認
- アーキテクチャ原則の遵守

## 品質管理

### 自動化
- **CI/CD**: プルリクエスト時の自動チェック
- **Pre-commit hooks**: コミット前の自動チェック
- **ファイル監視**: `just watch` で開発中の自動テスト

### 手動チェック
- 機能実装後の E2E テスト
- パフォーマンステスト
- セキュリティチェック

## トラブルシューティング

### よくある問題
1. **依存関係エラー**: `uv sync` で再同期
2. **型チェックエラー**: `mypy` で詳細確認
3. **テスト失敗**: `pytest -v` で詳細確認
4. **E2Eテスト失敗**: `just test-e2e debug` でデバッグ

### デバッグ手法
- **ログ確認**: `log/app.log`
- **ブラウザデバッグ**: `just test-e2e headed`
- **型チェック**: `just ty`

## ベストプラクティス

### コード品質
- 単一責任の原則を守る
- 依存性注入を使用
- エラーハンドリングを適切に実装

### テスト品質
- テストは独立して実行可能
- モックを適切に使用
- テストデータは fixtures で管理

### パフォーマンス
- 非同期処理を適切に使用
- メモリリークを避ける
- データベースクエリを最適化