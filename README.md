# AI-MAN: AI Multi-Agent Network

## 概要

AI-MAN (AI Multi-Agent Network) は、指定されたディレクトリに対して、**Unixコマンドとして提供されるAIツール**を非同期で実行し、その進捗状況を管理するためのWebアプリケーションです。

Streamlit製のUIを通じて、ユーザーは以下の操作を行うことができます。

- 実行したいAIツール（Unixコマンド）と対象のディレクトリパスから「プロジェクト」を作成する。
- 作成したプロジェクトの実行を指示し、subprocessを通じてコマンドを実行する。
- 実行中のプロジェクトのステータスをリアルタイムで確認する。
- AIツールの登録・編集・管理（コマンド文字列の設定を含む）を行う。

バックグラウンドでは、各プロジェクトが独立したプロセスとして実行されるため、複数のタスクを並行して処理することが可能です。

## 技術スタック

- **言語**: Python 3.12
- **パッケージ管理**: uv
- **Webフレームワーク**: Streamlit
- **タスクランナー**: just
- **テスト**: pytest, pytest-cov
- **静的解析・フォーマット**: ruff
- **その他**: Pydantic (データ検証)

## 開発環境のセットアップ

1. **リポジトリのクローン**:

    ```bash
    git clone <repository_url>
    cd aiman
    ```

2. **direnvの設定**:
    このプロジェクトでは、`direnv` を使って環境変数を管理します。`.envrc.template` をコピーして `.envrc` を作成してください。

    ```bash
    cp .envrc.template .envrc
    ```

    `.envrc` を開き、`GEMINI_API_KEY`にご自身のAPIキーを設定してください。

    `.envrc` ファイルがシェルのカレントディレクトリにある場合、`direnv` はその内容をロードします。
    初めてロードする際には、`direnv allow` を実行して内容の実行を許可する必要があります。

    ```bash
    direnv allow
    ```

    これにより、`uv`による仮想環境のセットアップと、プロジェクトの編集可能モードでのインストールが自動的に実行されます。

## 実行方法

各種コマンドは `just` を使って実行します。

- **アプリケーションの起動**:

  ```bash
  just run
  ```

  `http://localhost:8501` にアクセスしてください。

- **テストの実行**:

  ```bash
  just test
  ```

- **テストカバレッジの計測**:

  ```bash
  just coverage
  ```

- **LinterとFormatterの実行**:

  ```bash
  just lint
  just format
  ```

## AIツールとUnixコマンド実行

### 概要

AI-MANでは、AIツールをUnixコマンドとして定義し、実行します。これにより、様々なプログラミング言語で書かれたツールを統一的に管理・実行することができます。

### AIツールの定義

各AIツールは以下の情報を持ちます：

- **ツールID**: 一意識別子
- **ツール名**: 日本語表示名
- **説明**: ツールの概要
- **コマンド**: 実行するUnixコマンド文字列

### サポートされるコマンド形式

以下のようなコマンド形式をサポートしています：

- **Pythonスクリプト**: `python /path/to/script.py`
- **Node.jsスクリプト**: `node /path/to/script.js`
- **シェルコマンド**: `ls -la | grep "pattern"`
- **複合コマンド**: `python -c "import sys; print(sys.version)"`

### セキュリティ機能

- **コマンド長制限**: 最大1000文字まで
- **許可されたプレフィックス**: `python`, `node`, `git`, `ls`, `cat`, `grep`, `find`, `echo`で始まるコマンドのみ実行可能
- **ブロックされたコマンド**: `rm`, `sudo`, `chmod`など危険なコマンドは実行不可
- **実行タイムアウト**: 30秒でタイムアウト
